<!doctype html>
<html>
<head><meta charset="utf-8"><title>DEBUG Proxy Client</title></head>
<body>
  <h2>DEBUG: Proxy client runner</h2>
  <p>Open DevTools (F12) â†’ Console and Network. Click Fetch.</p>

  <label>Server IP</label>
  <input id="serverIp" value="127.0.0.1">
  <label>Port</label>
  <input id="serverPort" type="number" value="8080">
  <label>Target URL</label>
  <input id="target" value="https://example.com" style="width:100%">

  <button id="fetchBtn">Fetch via proxy</button>
  <pre id="log" style="white-space:pre-wrap;background:#eee;padding:8px"></pre>

<script>
console.log("DEBUG client script loaded"); 
document.getElementById('log').textContent += "DEBUG: script loaded\n";

function log(s){ console.log(s); document.getElementById('log').textContent += s + "\n"; }

function buildBase(){
  const ip=document.getElementById('serverIp').value.trim();
  const port=document.getElementById('serverPort').value.trim()||'8080';
  return 'http://'+ip+':'+port;
}

document.getElementById('fetchBtn').addEventListener('click', async ()=>{
  const base = buildBase();
  const target = document.getElementById('target').value.trim();
  if(!base || !target){ alert('fill fields'); return; }
  const endpoint = base.replace(/\/+$/,"") + '/proxy?url=' + encodeURIComponent(target);
  log('Requesting: ' + endpoint);

  try{
    const res = await fetch(endpoint, { method:'GET', mode:'cors' });
    log('Fetch returned, status: ' + res.status + ' ' + res.statusText);
    const headers = {};
    res.headers.forEach((v,k)=> headers[k]=v);
    log('Response headers: ' + JSON.stringify(headers,null,2));
    const ct = res.headers.get('content-type') || '[none]';
    log('Content-Type: ' + ct);

    if(!res.ok){
      const body = await res.text().catch(()=>"[no-body]");
      log('Non-OK body:\n' + body);
      return;
    }

    if(ct.startsWith('text/') || ct.includes('html') || ct.includes('json')){
      const txt = await res.text();
      log('Text body (first 1000 chars):\n' + txt.slice(0,1000));
    } else {
      const blob = await res.blob();
      log('Binary body size: ' + blob.size);
    }
  } catch(err){
    log('Fetch failed: ' + err);
    console.error(err);
  }
});
</script>
</body>
</html>
